
# 🍔 스팡잇츠 (SpangEats) README

## 프로젝트 소개

- 스팡잇츠는 배달의민족과 쿠팡이츠를 벤치마킹하여 개발된 배달 서비스 앱의 백엔드 프로젝트입니다.
- 사용자는 다양한 가게의 메뉴를 검색하고 주문할 수 있으며, 사장님은 가게와 메뉴를 관리할 수 있습니다.
- 주요 기능으로는 회원 관리, 가게 및 메뉴 관리, 주문 관리, 리뷰 기능 등이 포함됩니다.

<br>

---

## 팀원 구성

<div align="center">

| **이한식** | **김신희** | **박지예** | **지창현** | **최서영** |
| :------: |  :------: | :------: | :------: | :------: |
| <img src="images/이한식.png" height="150"> <br/> [@coldrice99](https://github.com/coldrice99) | <img src="images/김신희.png" height="150"> <br/> [@shinheekim](https://github.com/shinheekim) | <img src="images/박지예.png" height="150"> <br/> [@bbobsang](https://github.com/bbobsang) | <img src="images/지창현.png" height="150"> <br/> [@tesbro1194](https://github.com/tesbro1194) | <img src="images/최서영.png" height="150"> <br/> [@seoyeong-4811](https://github.com/seoyeong-4811) |

</div>

<br>

---

## 개발 기간 및 개발 환경

- **전체 개발 기간**: 2024-10-31 ~ 2024-11-07
- **협업 툴**: Slack, Notion
- **Back-end**: Java, Spring Boot, JPA
- **Database**: MySQL
- **버전 및 이슈관리**: GitHub, GitHub Issues

<br>

---

## 2. 채택한 개발 기술과 브랜치 전략

<img src="https://img.shields.io/badge/java-007396?style=for-the-badge&logo=java&logoColor=white"><img src="https://img.shields.io/badge/spring-6DB33F?style=for-the-badge&logo=spring&logoColor=white"><img src="https://img.shields.io/badge/springboot-6DB33F?style=for-the-badge&logo=springboot&logoColor=white"><img src="https://img.shields.io/badge/mysql-4479A1?style=for-the-badge&logo=mysql&logoColor=white"><img src="https://img.shields.io/badge/git-F05032?style=for-the-badge&logo=git&logoColor=white">
<img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white"><img src="https://img.shields.io/badge/gradle-02303A?style=for-the-badge&logo=gradle&logoColor=white"><img src="https://img.shields.io/badge/postman-FF6C37?style=for-the-badge&logo=postman&logoColor=white">

### Spring Boot & JPA

- **Spring Boot**를 사용하여 RESTful API 설계와 서버 구축을 진행하였습니다.
- **JPA**로 데이터베이스와의 매핑을 통해 효율적인 데이터 관리 및 트랜잭션을 유지했습니다.

### JWT 인증

- 사용자 인증에 **JWT(Json Web Token)**를 적용하여 회원 로그인과 인증을 처리했습니다.

### 브랜치 전략

- Git-flow 전략을 활용하여 **main**, **develop**, **issue** 브랜치를 관리했습니다.
    - **main**: 배포 버전을 관리하는 브랜치
    - **develop**: 개발 단계에서 통합되는 브랜치
    - **issue**: 기능별로 작업 후 develop 브랜치에 병합

<br>

---

## 프로젝트 설계

### 와이어프레임

#### 1. 회원 관리
<img src="images/와이어프레임/회원기능 와이어프레임.png" alt="회원 기능 와이어프레임" width="1200">

#### 2. 가게 관리
<img src="images/와이어프레임/가게 와이어프레임.png" alt="가게 와이어프레임" width="1200">

#### 3. 메뉴 관리
<img src="images/와이어프레임/메뉴 와이어프레임.png" alt="메뉴 와이어프레임" width="1200">

#### 4. 주문 관리
<img src="images/와이어프레임/주문 와이어프레임.png" alt="주문 와이어프레임" width="1200">

#### 5. 리뷰 관리
<img src="images/와이어프레임/리뷰 와이어프레임.png" alt="리뷰 와이어프레임" width="1200">

### ERD (Entity Relationship Diagram)

서비스의 데이터베이스 구조는 아래 ERD에 기반합니다. 각 엔터티와 관계를 통해 효율적인 데이터 관리를 고려했습니다.

<img src="images/스팡잇츠 erd.png" alt="스팡잇츠 ERD" width="1200">

<br>

---

## 프로젝트 구조

```
├── README.md
├── .gitignore
├── build.gradle
├── src
│   ├── main
│   │   ├── java
│   │   │   └── com.sparta.spangeats
│   │   │       ├── common                # 공통 유틸리티 및 기능
│   │   │       ├── domain                # 주요 도메인별 패키지
│   │   │       │   ├── address           # 주소 관련 엔티티 및 로직
│   │   │       │   ├── auth              # 인증 관련 로직
│   │   │       │   ├── basket            # 장바구니 기능 관련
│   │   │       │   ├── cart              # 장바구니 내 아이템 관리
│   │   │       │   ├── member            # 사용자 정보 관리
│   │   │       │   ├── menu              # 메뉴 관리
│   │   │       │   ├── order             # 주문 관리
│   │   │       │   ├── orders            # 주문 상태 관리
│   │   │       │   ├── review            # 리뷰 기능 관련
│   │   │       │   └── store             # 가게 정보 관리
│   │   │       └── security              # 보안 관련 설정
│   │   │           ├── config            # 보안 설정 구성
│   │   │           └── filter            # 인증 및 필터링 기능
│   │   └── resources
│   └── test
│       └── java
│           └── com.sparta.spangeats
│               ├── authtest             # 인증 관련 테스트
│               ├── carttest             # 장바구니 관련 테스트
│               └── review               # 리뷰 관련 테스트
└── SpangEatsApplicationTests.java
```

<br>

---

## 역할 분담

### 🧑‍💻 이한식
- **회원 기능**: 로그인, 회원가입, 회원탈퇴, 회원정보 조회 및 수정, 관리자 기능 - 전체 회원정보 조회
- **카카오 소셜 로그인 기능**

### 👩‍💻 김신희
- **가게 관리**: 가게 등록, 조회, 수정, 폐업 처리
- **가게 조회 기능**: 검색 기능을 통해 가게를 이름 또는 조건별로 조회

### 👩‍💻 박지예
- **메뉴 관리**: 가게 내 메뉴 등록, 수정, 삭제
- **메뉴 상태 관리**: 가게 조회 시 삭제된 메뉴는 표시되지 않도록 처리

### 👨‍💻 지창현
- **주문 기능**: 주문 생성, 주문 상태 변경(요청, 수락, 배달중, 배달 완료)
- **주문 로그 관리**: 주문 상태 변경 시 로그 기록 기능 구현

### 👩‍💻 최서영
- **리뷰 기능**: 리뷰 작성, 수정, 삭제
- **리뷰 필터링**: 별점 기준으로 리뷰를 필터링하여 조회

<br>

---

## 페이지별 기능

### 회원 기능

#### 회원가입 및 로그인

- **회원가입**: 이메일과 비밀번호를 입력받아 검증한 후, `CustomPasswordEncoder`를 사용해 비밀번호를 암호화하여 안전하게 저장합니다.
- **일반 로그인**: 이메일과 비밀번호를 통해 로그인 시 검증을 수행하고, JWT 토큰을 발급하여 인증을 처리합니다.
- **관리자 로그인**: 추가적인 `admin` 키 입력을 통해 검증을 거친 후 로그인할 수 있습니다.

#### 회원 정보 조회 및 수정

- **정보 조회**: 사용자는 자신의 정보를 조회할 수 있습니다.
- **정보 수정**: 사용자는 본인의 정보를 업데이트할 수 있습니다.

#### 회원 탈퇴

- **탈퇴 처리**: 본인 요청 시 계정을 탈퇴 처리하며, 삭제된 계정은 재사용이 불가하도록 설정합니다.

#### 관리자 기능

- **전체 회원 조회**: 관리자 권한으로 모든 회원 정보를 조회하여 사용자 관리 기능을 제공합니다.

#### 카카오 소셜 로그인

- **제한 사항**: 카카오 API를 통해 소셜 로그인 시 아이디, 이메일, 닉네임 정보를 받아오지만, 일부 비밀번호 검증이 필요한 기능에는 접근이 제한됩니다.

---

### 가게 등록 및 조회

- **가게 등록**: 사장님 권한을 가진 사용자만 최대 3개까지 가게를 등록할 수 있습니다.
- **공지 관리**: 가게 공지 입력 시 금지어가 포함되지 않도록 제한합니다.
- **가게 조회**: 특정 가게 조회 시 메뉴 정보도 함께 조회할 수 있으며, 이름으로 조회할 경우 오픈 상태인 가게만 최근 등록일 순으로 조회됩니다.

---

### 메뉴 관리

- **메뉴 관리**: 가게 내 메뉴 추가, 수정, 삭제가 가능합니다. 삭제된 메뉴는 조회 시 표시되지 않도록 설정됩니다.

---

### 장바구니 및 주문 관리

#### 장바구니

- **메뉴 추가**: 장바구니에 메뉴를 추가할 수 있으며, 다른 매장 메뉴를 추가할 경우 기존 장바구니 항목이 초기화됩니다.
- **수량 업데이트**: 같은 메뉴가 장바구니에 추가될 경우 수량을 업데이트하고, 없으면 새로운 항목으로 생성합니다.
- **장바구니 관리**: 장바구니 항목 조회, 수량 업데이트, 삭제가 가능하며, 하루 이상 지난 항목은 매일 자정에 자동으로 삭제됩니다 (스케줄러 적용).

#### 주문

- **주문 생성**: 장바구니 항목을 기반으로 주문을 생성하며, 각 메뉴 존재 여부를 확인하여 중간 테이블에 기록합니다.
- **주문 조건**: 최소 주문 금액 이상이어야 하며, 오픈 시간 전이나 마감 시간 이후에는 주문이 불가합니다.
- **주문 조회**: 특정 주문 및 모든 주문에 대한 조회가 가능하며, 주문 상태는 `REQUEST`, `CANCEL`, `ACCEPTED`, `REJECTED`로 관리됩니다. 향후 배달 시작 및 완료 상태도 추가될 예정입니다.

---

### 리뷰 작성 및 조회

- **리뷰 작성**: 주문 한 건당 한 번의 리뷰 작성이 가능하며, 객체 참조 없이 필드를 가지는 방식으로 구현되었습니다.
- **리뷰 조회**: 페이지네이션을 적용하여 가게별 조회, 회원별 조회가 가능하며, JPQL을 사용해 가게별 리뷰 조회를 수행합니다.
- **테스트 코드**: 각 메서드에 대한 테스트 코드가 작성되어 기능 검증이 완료되었습니다.

<br>

---

## 개선 목표

### 회원 기능
- **검증 로직의 일관성 유지**: 현재 검증 로직이 서비스와 필터에 분산되어 있어 관리와 유지보수가 어렵습니다. 서비스 레이어 또는 필터 중 한 곳에 검증 로직을 일관되게 통합하여, 코드 가독성과 유지보수성을 높일 예정입니다.
- **관리자 기능 확장**: ADMIN 역할을 추가하여 관리자가 특정 기능에 접근할 수 있도록 구현했으나, 현재는 전체 회원 정보 조회 기능만 제공됩니다. 향후 관리자만 사용할 수 있는 다양한 기능을 추가하여, 관리 기능의 활용성을 높일 예정입니다.
- **카카오 소셜 로그인 제한사항 개선**: 카카오 API를 통해 제공되는 정보가 이메일, 닉네임, 카카오 ID에 국한되어 있어, 패스워드 검증이 필요한 API 사용이 불가함. 이를 해결하기 위해, 패스워드가 필요한 서비스에 대하여 대체 인증 방안을 모색하거나, 소셜 로그인 방식에 맞는 별도의 접근 제어 로직을 고려할 예정입니다.

### 가게 관리 기능
- **가게와 메뉴의 연관관계 개선**: 가게와 메뉴의 연관관계를 1:N(양방향)으로 설정했는데, 가게 조회시 메뉴 객체를 반환하다 보니 참조순환 문제가 발생하였습니다. 시간 관계상 `@JsonIgnore` 으로 참조순환 문제를 방지하였는데, 객체를 반환하는 것보다 Menu에서 필요한 정보만 반환하는것이 더 좋을 것 같습니다.
- **카테고리별 조회 기능 추가**: 가게의 카테고리를 설정하여 (중식,일식,한식 등) 카테고리 별로 조회되는 기능을 넣어보면 더 좋을것 같습니다.

### 메뉴 관리 기능
- **카테고리 및 옵션 기능 추가**: 도전과제 프로젝트 중, 메뉴의 **카테고리**와 **옵션** 영역을 구현하려 했으나 기술적 어려움으로 인해 해당 부분을 제외하기로 결정했습니다. 특히 데이터베이스 관련 문제로 인해 카테고리와 옵션 추가 시 복잡성이 증가하고 오류가 발생하여, 최종 구현에서 해당 기능을 제외하게 되었습니다. 추후에 카테고리와 옵션 기능을 개선하여 정상적으로 작동하도록 하고, 포스트맨 테스트까지 완료할 계획입니다.

### 주문 관리 기능

### 리뷰 관리 기능
- 예외 처리 추가
- 주문 완료 후 리뷰는 14일 이내 작성
- 리뷰 작성 후 수정은 리뷰 작성 7일 이내 가능
- 연관 관계를 맺지 않아 회원이 탈퇴 이후에도 데이터가 DB에 남는 문제 해결

<br>

---
## 프로젝트 후기

### 🧑‍💻 이한식
> 이번 프로젝트에서 **회원가입, 로그인, 회원탈퇴 기능**을 구현하며, Spring Security와 JWT 방식의 이점에 대해 깊이 이해하게 되었습니다. 초기에는 패스워드 인코더를 직접 구현해야 한다는 발제 조건 때문에 JWT만으로 인증을 구현하려 했지만, Spring Security의 내장 기능이 보안성과 유지보수성 측면에서 우수하다는 것을 알게 되어 최종적으로 Spring Security와 JWT 방식을 도입했습니다.

> 또한, 인증 및 인가 필터를 직접 구현하고, USER와 OWNER 외에 **ADMIN 역할**을 추가해 관리자만 접근할 수 있는 기능을 `/api/admin` 엔드포인트로 설정했습니다. 비록 관리자 권한 기능으로 전체 회원 정보 조회 기능만 구현이 됐지만, 다양한 관리 기능을 확장할 계획도 세웠습니다.

> 마지막으로, **카카오 소셜 로그인** 기능을 구현했으나 API 권한 한계로 인해 아이디, 이메일, 닉네임 정보만 활용할 수 있어 패스워드 검증이 필요한 일부 기능에 접근하지 못한 점은 아쉬웠습니다. 이러한 제한 사항을 어떻게 개선할지에 대해 고민하게 되는 계기가 되었습니다.

### 👩‍💻 김신희
> 가게 관리 및 조회 기능을 통해 데이터베이스와 API 설계의 중요성을 느꼈습니다. 팀원들과 함께 프로젝트를 완성할 수 있어 기쁩니다.

### 👩‍💻 박지예
> 기능을 구현하는 과정에서 많은 실수를 겪었는데, 그 실수를 해결하지 못하고 끝내는 것이 매우 속상하고 아쉽습니다.  향후에는 시간관리를 체계적으로 분배하고 관리해야할 필요성이 있다고 느꼈습니다. 실력이 모자라 팀원 분들께 피해만 끼친것같아 죄송스럽기도 한 마음입니다. 그래도 좋은 팀원분들 덕분에 무사히 프로젝트를 완수할 수 있었던것 같습니다. 고생들 많으셨고 감사했습니다

### 👨‍💻 지창현
> 다양한 방식으로 구현을 할 수 있고, 방식마다 장단점이 있다는 걸 확실히 느꼈습니다. 예를 들자면 가게 별 리뷰를 조회할 때, 가게와 리뷰의 연관 관계가 없는 문제를 어떻게 해결할 것인가? 라는 문제가 있습니다.
> 1. 가게와 리뷰의 ID를 갖는 테이블을 만든다.
> 2. 가게와 리뷰가 연관관계를 갖게 한다.
> 3. `가게 - 주문 - 리뷰` 라는 연결고리를 이용하여 로직으로 풀어낸다.
> 4. 연관 관계를 맺지 않고 필요로 하는 엔티티의 id를 필드로 갖게 한다.
> 저는 4번을 선택했습니다.
> 코드 리뷰를 많이 하지 못해 아쉽습니다. 
> 제가 부족해서 팀원들에게 미안합니다….

### 👩‍💻 최서영
> 팀원들과 큰 문제와 갈등 없이 프로젝트를 마무리 할 수 있어서 다행인것 같습니다.  이번 프로젝트에서 가장 기본적인 crud를 담당하였는데, 팀원들의 자세한 코드리뷰와 조언들을 통해 부족했던 부분들을 보완할 수 있었습니다. 또한 제가 담당하지 않았던 회원가입/로그인 부분과 연관관계 부분들을 참고하면서 공부가 많이 되었습니다. 브랜치 전략과 rebase 사용 전략은 아직도 헷갈리는 부분들이 많아서 이 부분도 공부가 필요하겠다는 생각을 했습니다. 배운것도 많고 부족함도 많이 느끼게 되는 프로젝트 였습니다.
